# 伤害计算（GS/SR）开源方案调研摘记

> 目的：为 metaGenerator 的 `calc.js`（details/buffs/defParams 生成）提供可复用的工程思路与校验方法；不直接复用基线 meta 代码。

## 1) 调研入口（证据）

- Gemini Deep Research 分享（需代理）：`https://gemini.google.com/share/3726404b85e7`
  - 标题：原神与崩坏：星穹铁道开源伤害计算方案与数值建模框架深度研究报告

## 2) 关键项目与方法论

### 2.1 原神（GS）

- `gcsim`（Monte Carlo / 帧级战斗模拟）
  - Repo：`https://github.com/genshinsim/gcsim`
  - 核心价值：把“伤害”从静态面板提升为**时序仿真**（操作序列、能量、ICD、帧数据、buff 覆盖率）。
  - 对 metaGenerator 的启示：我们不做完整仿真，但可以借鉴其“可追溯证据链”思路——把关键假设显式化（params/defParams），并在回归中固定输入与输出。

- `Genshin Optimizer`（启发式搜索 + 计算图）
  - Repo：`https://github.com/frzyc/genshin-optimizer`
  - Pando 引擎：`libs/pando/engine/`，以 **Calculation Graph（计算图）** 表达复杂 buff 叠加与触发条件。
  - 对 metaGenerator 的启示：LLM 产物应尽量“结构化计划 -> 本地渲染”，降低自由文本导致的语义漂移；必要时用更严格的校验约束 details/buffs 的可用性。

### 2.2 崩坏：星穹铁道（SR）

- `hsr-optimizer`（全栈优化 + DPS 评分）
  - Repo：`https://github.com/fribbels/hsr-optimizer`
  - 核心价值：回合制模型下的**状态/时序**（行动提前、速度阈值、击破等）与工程化的规则落地。
  - 对 metaGenerator 的启示：面板对标并不等于“总 DPS 对标”，但 SR 的 details/buffs 仍需要覆盖更多“默认状态”（defParams）与机制分支，避免出现大量 0 值/空行。

## 3) 映射到 metaGenerator 的可执行落地

metaGenerator 的 `calc.js` 目标是 miao-plugin 的面板计算（details + buffs），而不是完整战斗仿真；因此落地重点应当是：

- **输入完备**：给 LLM/启发式提供完整 talent blocks（SR 不止 a/e/q/t，记忆命途会出现 me/mt/...）。
- **默认状态**：从 tables/desc/buffHints 推导 SR `defParams`（例如 `Memosprite: true`），避免运行时默认状态不一致。
- **强校验 + 重试**：对 LLM 仅允许输出 JSON 计划；本地渲染后做语法 + 运行时自检，失败自动重试，最终回退启发式。
- **证据链回归**：以 `circaltest/panel-regression.mjs` 固定 UID/输入，持续输出 evidence（baseline vs generated）用于迭代。

