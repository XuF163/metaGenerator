云崽（Yunzai-Bot）Miao-Plugin 元数据与伤害计算自动化生成可行性深度研究报告摘要本报告旨在深入探讨针对 Yunzai-Bot 框架下 Miao-Plugin 插件及其衍生扩展 Liangshi-Calc 的游戏元数据（Meta Data）与伤害计算逻辑（Damage Calculation）实现自动化生成的全链路可行性。随着 原神 (Genshin Impact) 与 崩坏：星穹铁道 (Honkai: Star Rail) 等游戏版本更新频率的加快，传统的人工维护数据模式已难以满足社区对时效性和准确性的即时需求。本研究以 Liangshi-Calc 为参考标杆，通过解构 Miao-Plugin 的底层数据模型，对比分析 Dimbreath/GenshinData、Ambr.top 及 Hakush.in 等原始数据源的可靠性与结构特性，提出了一套基于解析管线（Parser Pipeline）的自动化解决方案。研究结论表明，静态元数据文件（data.json）的自动化生成具备极高的可行性（接近 100%），其核心在于建立从游戏原始 Excel 配置表到插件 Schema 的确定性映射算法。相比之下，动态伤害计算脚本（calc.js）的完全自动化面临语义鸿沟的挑战，仅具备部分可行性（约 65%-75%）。针对复杂的条件性增益（Conditional Buffs）与机制性逻辑，报告建议采用“自动化脚手架 + 人工启发式修正”的混合开发模式。本报告将详细阐述相关的技术架构、数据源评测、算法逻辑设计及潜在风险，为开发者构建高效的数据维护管线提供理论依据与实操参考。1. 引言1.1 研究背景在开源社区驱动的 Yunzai-Bot 生态系统中，Miao-Plugin 凭借其精美的角色面板展示与精确的伤害计算功能，已成为该框架下的核心组件 。然而，该插件的运作高度依赖于底层数据的准确性。每一个新角色的实装，都要求维护者在极短的时间内完成两项核心工作：一是构建包含基础属性、成长曲线、突破材料等信息的静态元数据文件；二是编写反映角色技能倍率、天赋机制及命座效果的 JavaScript 计算脚本。Liangshi-Calc 作为 Miao-Plugin 的高级扩展，通过引入更复杂的“智能组队计算”与“极限面板”功能，进一步推高了数据维护的门槛 。其能够快速响应版本更新的能力，暗示了背后可能存在某种程度的自动化或半自动化工具链支持。探究这一工具链的实现原理，对于提升整个社区的开发效率至关重要。1.2 研究目标本报告的核心目标是回答以下关键技术问题：数据源解析：哪些原始 API 能够提供最可靠、最及时的游戏解包数据？结构映射：如何将原始的游戏配置文件（ExcelConfig）无损映射为 Miao-Plugin 所需的 JSON 格式？逻辑生成：是否可能通过解析自然语言描述或参数列表，自动生成复杂的伤害计算函数？工程落地：参考 Liangshi-Calc 的实现，如何构建一个可持续的自动化更新管线？1.3 报告范围本研究主要聚焦于 原神 相关的角色数据自动化，但也涉及跨游戏（如 崩坏：星穹铁道）的通用数据处理逻辑。分析对象仅限于公开可获取的数据源与开源代码库，不涉及任何破坏游戏公平性的逆向工程或私有协议破解。2. 目标系统架构解构要实现自动化生成，首要任务是彻底理解目标系统——即 Miao-Plugin 与 Liangshi-Calc 的数据消费模式。这决定了自动化工具的“输出规格”。2.1 Miao-Plugin 数据模型深度分析Miao-Plugin 并未采用传统的关系型数据库（如 SQLite 或 MySQL）来存储静态数据，而是采用了一种基于文件系统的“配置即数据”模式。这种设计使得Git版本控制极其方便，也为自动化脚本的文件读写提供了便利。2.1.1 目录结构与文件组织在标准的 Miao-Plugin 安装环境中，角色数据被离散存储于 resources/meta-gs/character/ 目录下 。每一个角色拥有独立的文件夹，文件夹名称通常为角色的中文名（如“神里绫华”）。该目录下必须包含的核心文件有两个：data.json：静态元数据定义文件。calc.js：动态伤害计算逻辑文件。此外，还可能包含 imgs/ 子目录用于存储角色立绘、技能图标等资源，但本报告主要关注数据与逻辑的生成。2.1.2 data.json Schema 解析data.json 是角色基础属性的静态快照。通过分析开源社区中的示例文件与 package.json 中的依赖描述 ，我们可以归纳出其核心字段结构：基础信息 (Identity):id: 游戏内部的角色 ID（AvatarID），如 10000002。name: 角色名称，作为索引键。element: 元素属性，枚举值（Cryo, Pyro, Hydro 等）。weapon: 武器类型，枚举值（Sword, Bow, Catalyst 等）。star: 星级，整数（4 或 5）。战斗属性 (Combat Stats):这是自动化生成的第一个难点。Miao-Plugin 通常存储的是角色在 Lv90 时的面板属性（基础生命值 hp、基础攻击力 atk、基础防御力 def）。而在游戏原始数据中，这些值通常以 Lv1 的基础数值配合“成长曲线 ID”（Growth Curve ID）的形式存在。自动化工具必须内置插值算法，根据曲线计算出 Lv90 的最终值。突破材料 (Ascension Materials):materials: 一个包含材料名称的数组。例如 ["哀叙冰玉碎屑", "恒常机关之心", "绯樱绣球", "名刀镡"]。这些数据对应游戏内的 AvatarPromoteExcelConfigData 表。自动化工具需要建立 ID 到 文本（TextMap）的映射。天赋配置 (Talent Configuration):talentCons: 描述命座对技能等级的提升（例如“C3 提升 Q 技能等级 3 级”）。这对应游戏数据中的 Depot 配置。2.1.3 calc.js 逻辑架构解析calc.js 是 Miao-Plugin 的灵魂所在，它将静态属性转化为动态的伤害数值。该文件本质上是一个 Node.js 模块，导出了特定的对象结构。理解其 API 是实现自动化的关键 。details 数组:定义了具体的伤害条目。每个条目是一个对象，包含：title: 伤害描述（如“神里流·霜灭 斩击伤害”）。dmg: 一个回调函数 ({ talent, attr, calc, cons }) =>Result。talent: 包含当前技能的倍率数据（通常即时读取自 data.json 或解包数据）。attr: 当前面板属性（攻击、暴击、增伤等）。calc: 核心计算函数，用于执行 (攻击区 * 倍率区) * 增伤区 * 暴击区 * 防御区 * 抗性区 的标准公式。核心挑战: 自动化工具必须能够从游戏文本“造成 200% 攻击力的冰元素伤害”中，解析出 attr.atk * 200 / 100 这一代码逻辑。buffs 数组:定义了条件性的属性修正。title: Buff 名称（如“霰步：获得 18% 冰伤加成”）。check: 判定函数 ({ params, cons }) => Boolean。data: 属性修正对象 { dmg: 18 }。核心挑战: Buff 的触发条件（如“施放元素战技后”、“生命值低于 50%”）在原始数据中通常是自然语言描述，极难通过简单的正则匹配完美转译为代码逻辑。2.2 Liangshi-Calc 的扩展架构Liangshi-Calc 在 Miao-Plugin 的基础上进行了显著扩展 。多维计算 (Multi-dimensional Calculation):Liangshi 不仅计算单次伤害，还计算 DPS（每秒伤害）、总伤（Total Damage）以及不同圣遗物评分标准下的期望伤害。这要求 data.json 或 calc.js 中包含循环轴（Rotation）信息，例如“Q技能在 20秒 CD 内造成 19 段伤害”。这些信息在游戏原始数据中是不存在的，通常来源于玩家社区（如 NGA 或 KeqingMains）的理论分析。因此，这部分的自动化生成几乎是不可能的，必须依赖人工维护的“预设库”。数据更新机制 (Update Mechanism):
通过分析 apps/update.js ，Liangshi 采用了远程拉取机制。它支持：增量更新: 仅下载新版本新增的角色 ID 对应的数据。强制覆盖: 当底层公式或字段定义发生变更时，重写整个 meta 目录。这种机制提示我们，自动化工具应当部署在“服务端”（即维护者的开发机上），生成标准文件后，通过 Git 或 CDN 分发给终端用户，而不是让每个用户的机器都运行一遍复杂的解包程序。3. 原始 API 来源的可靠性与深度评测“垃圾进，垃圾出”（Garbage In, Garbage Out）。自动化生成的质量完全取决于输入数据的质量。目前社区主要存在三类数据源。3.1 核心数据源：Dimbreath/GenshinData (GitHub)这是目前 Yunzai 生态及绝大多数 Genshin 工具（包括 Enka, Ambr）的 “圣经” 级数据源 。数据本质: 它是游戏客户端内 ExcelBinOutput 文件夹下 .json 文件的直接转储（Dump）。关键文件映射:游戏原始文件包含的关键信息对应 Miao-Plugin 字段AvatarExcelConfigData.json基础属性、武器类型、突破IDhp, atk, def, element, weaponAvatarSkillExcelConfigData.json技能图标、技能名称、描述 Hashtalent.a/e/q.name, iconProudSkillExcelConfigData.json技能具体倍率数值、参数列表calc.js 中的倍率数值AvatarTalentExcelConfigData.json命座效果、命座图标buffs 中的命座部分AvatarCurveExcelConfigData.json等级成长曲线系数用于计算 Lv90 属性TextMap/TextMapCHS.json所有 ID 对应的中文文本角色名、技能描述文本可靠性评级: S级。只要游戏更新，此仓库通常会在维护结束后的数小时内更新。使用难点:数据碎片化: 要获取一个角色的完整信息，需要通过 ID 在 5-6 个不同的 JSON 文件中进行“跳表”查询（Join 操作）。混淆问题 (Obfuscation): 研究片段  提到，5.5.0 版本后游戏引入了字段乱序和新加密，导致 BinOutput（包含动作帧、判定框等详细数据）难以获取。但 ExcelConfigData（配置数据）目前仍相对稳定，这对于面板计算通常已经足够。3.2 结构化 API：Ambr.top (Project Amber)Ambr.top 是一个基于 Dimbreath 数据二次开发的 API 服务 。数据本质: 加工后的结构化 JSON。优势:它完成了最繁琐的“表连接”工作。访问 /v2/en/avatar/{id} 即可一次性获得角色的属性、技能、命座、材料等所有信息。它自动计算了 Lv90 的属性值，省去了开发者自己写插值算法的麻烦。它将技能描述中的 {param1:F2P} 占位符预处理为了具体数值，极大降低了文本解析难度。劣势:依赖性风险：如果 Ambr 的解析器更新滞后，自动化工具就会停摆。细节丢失：为了 API 的简洁，可能会丢失一些极其冷门的参数（例如某些特定附魔的内部 ID），而这些参数在编写极度复杂的 calc.js 时可能用到。可靠性评级: A级。适合作为“快速开发”的首选源。3.3 测试服/解包源：Hakush.inHakush.in 专注于提供测试服（Beta）数据 。核心价值: 它的数据往往早于正式服上线。对于 Liangshi-Calc 这类追求“零日支持”（Day 0 Support）的插件，Hakush.in 是获取未上线角色数据的唯一渠道。风险: 测试服数据变动频繁，V1 到 V4 版本的技能倍率可能天差地别。基于此源生成的 calc.js 需要频繁重新生成。3.4 推荐的数据源组合策略为了构建最可靠的自动化管线，建议采用 层级化数据获取策略：首选 (Primary): Dimbreath/GenshinData。直接读取 GitHub Raw 文件。这是最稳健、最抗风险的方式，虽然开发初期成本高（需要写复杂的解析器），但长期维护成本低，不依赖第三方 API 的稳定性。辅助 (Secondary): Ambr.top。用于校验数据准确性，或者在本地解析逻辑出错时作为备用（Fallback）。尝鲜 (Beta): Hakush.in。仅用于生成尚未进入正式服的角色数据。4. 静态元数据（Meta Data）自动化生成的算法实现本节将详细阐述如何通过算法，将 Dimbreath 的原始 Excel 数据转换为 Miao-Plugin 的 data.json。4.1 属性计算算法 (Stat Calculation)游戏中的属性计算公式为：$$\text{Val}_{\text{Level}} = \text{BaseValue} \times \text{CurveMultiplier}_{\text{Level}} + \text{PromoteBonus}_{\text{Ascension}}$$自动化步骤:读取基础值: 从 AvatarExcelConfigData.json 读取 hpBase, attackBase, defenseBase。读取曲线类型: 获取 propGrowCurves 字段中的 growCurve ID（例如 GROW_CURVE_HP_S4）。查表计算:加载 AvatarCurveExcelConfigData.json。找到对应 Curve ID 在 Level 90 的系数（例如 14.5）。计算基础乘积：$Base \times 14.5$。叠加突破加成:读取 avatarPromoteId。加载 AvatarPromoteExcelConfigData.json。找到该 Promote ID 在 6 阶突破（Ascension 6）下的 addProps。将突破带来的固定数值加成（如果有）叠加到结果中。注意: Miao-Plugin 的数据结构有时会直接存储 Lv90 的最终白值，有时存储 Base + Curve ID。Liangshi-Calc 倾向于存储最终计算好的数值以减少运行时的计算压力。自动化脚本应直接输出计算后的 Lv90 结果。4.2 材料映射算法 (Material Mapping)Miao-Plugin 需要显示角色突破和天赋升级所需的材料名称。自动化步骤:突破材料:从 AvatarPromoteExcelConfigData 获取 costItems（消耗物品 ID 列表）。过滤掉摩拉（Mora）和经验书，保留特产、宝石和 Boss 掉落物。通过 MaterialExcelConfigData.json 将 Item ID 转换为 NameTextMapHash。通过 TextMapCHS.json 将 Hash 转换为中文名称（例如“最胜紫晶”）。天赋材料:通过 AvatarSkillDepot 找到 subSkillId（通常关联天赋升级配置）。同样查询 Promote 表（天赋也有 Promote 配置），提取“周本材料”和“天赋书”名称。4.3 技能图标与 ID 关联Miao-Plugin 使用 cons 字段记录命座对技能等级的提升。这在原始数据中存储在 AvatarSkillDepot 的 talents 列表中。Depot.talents 对应 1 命，talents 对应 6 命。查询 AvatarTalentExcelConfigData，检查 openConfig 字段。如果包含 SkillLevel 关键字，解析其参数（如 AddLevel: 3），并记录对应的技能 ID（E 或 Q）。结论: 整个 data.json 的生成逻辑是 完全确定性 的算法，不存在模糊地带。只要原始数据格式不变，此部分可行性为 100%。5. 伤害计算逻辑（Calc.js）自动化生成的深度挑战相比元数据，calc.js 的自动化是真正的难点。这里涉及到将“自然语言描述”转化为“可执行代码”。5.1 简单倍率的自动化（Regex Parsing）对于大多数输出型角色，技能伤害描述遵循严格的格式。例如：文本: "一段伤害 | {param1:F1P}"数据: paramList: [0.58,...]自动化逻辑:正则提取: 使用正则表达式 /(.*?)\|\s*\{param(\d+):.*?\}/ 扫描 TextMap 中的技能详情。AST 构建:捕获组 1（描述）: "一段伤害" -> 映射为 title。捕获组 2（参数索引）: 1 -> 映射为 talent.a['param1']。代码生成:JavaScript{
  title: "一段伤害",
  dmg: ({ talent, attr, calc }) => ({
    dmg: calc(attr.atk * talent.a['param1'] / 100),
    type: "phy" // 默认为物理，需进一步判断附魔
  })
}
属性推断:如何知道是乘以 attr.atk 还是 attr.def？方法 A (关键词法): 扫描描述文本。如果包含“基于防御力”（Based on DEF），则将公式中的 attr.atk 替换为 attr.def。方法 B (ProudSkill 标志): ProudSkill 数据中包含 costElemType 或类似的属性字段，暗示了伤害的加成基数，但文本分析通常更准确。5.2 复杂机制的语义鸿沟 (Semantic Gap)当遇到如下描述时，自动化脚本通常会失效：“基于生命值上限的 1.8%，提高普通攻击造成的伤害。”这里的逻辑不再是简单的 Base * MotionValue，而是 Add(Base, HP * 0.018)。这属于“基础倍率区”的增益。解决方案：基于规则的各种模板 (Rule-Based Templates)Liangshi-Calc 的高明之处在于它可能拥有一个“常用模板库”。自动化工具不应试图理解所有自然语言，而应匹配特定句式：句式: "Increase... DMG by... of HP"生成代码: buffs.push({ title: "HP转伤", data: { aDmg: calc(attr.hp * 0.018) } })5.3 无法自动化的部分某些机制是全新的，无法预知。例如：雷电将军的“愿力”系统: 涉及积攒层数、动态结算。阿蕾奇诺的“生命之契”: 涉及百分比条的增减。对于这些部分，自动化工具应当生成 占位符 (Placeholder) 代码，并添加 // TODO: Manual implementation required 注释，提示开发者人工介入。6. 构建参考 Liangshi-Calc 的自动化管线基于上述分析，我们建议构建如下的工程化管线，以实现从数据源到插件成品的转换。6.1 技术选型编程语言: Node.js。因为输入（JSON）和输出（JS）都是 JavaScript 生态，且 Miao-Plugin 本身基于 Node.js，复用现有 Model 类库（如 Start Snippet  中的依赖）非常容易。请求库: axios 或 node-fetch，用于拉取 GitHub Raw 数据。文件处理: fs-extra，用于原子化写入文件。6.2 管线流程图 (Pipeline Workflow)Trigger (触发器):监听 Dimbreath/GenshinData 仓库的 Commit Webhook。一旦检测到 ExcelBinOutput 变动，启动构建。Extraction (抽取):拉取 AvatarExcelConfigData。与本地缓存对比，识别出新增的 AvatarID。Generation (生成):Meta Gen: 运行 4.1 和 4.2 算法，生成 data.json。Calc Gen: 运行 5.1 算法。如果角色技能描述匹配标准模板（如纯倍率），直接生成可用 calc.js。如果检测到未知关键词（如“生命之契”），生成包含基础倍率的 calc.js，并将复杂部分留空。Verification (校验):使用 JSON Schema 校验生成的 data.json 格式是否符合 Miao-Plugin 定义。单元测试: 模拟一个 attr 对象，运行生成的 calc.js，检查是否抛出语法错误或 NaN 结果。Distribution (分发):将生成的文件提交到类似 liangshi-calc 的仓库中。用户端通过 apps/update.js 逻辑拉取更新。6.3 关键数据表对照 (Cheat Sheet)为了方便开发者实现，以下是核心字段的映射表：目标字段 (data.json)来源文件来源 JSON 路径 (Key Path)处理逻辑nameAvatarExcelConfigData.jsonnameTextMapHash查表 TextMapelementAvatarExcelConfigData.jsoncostElemType映射枚举 (10->Anemo)hp (Lv90)AvatarExcelConfigData.jsonhpBase, propGrowCurvesBase * Curve[Lv90]talent.e.nameAvatarSkillExcelConfigData.jsonabilityName关联 skillDepotIdtalent.e.attrProudSkillExcelConfigData.jsonparamList正则匹配描述中的索引cons.2.descAvatarTalentExcelConfigData.jsondescTextMapHash查表 TextMap7. 风险评估与应对策略7.1 数据源混淆风险 (Obfuscation)如  所示，游戏厂商可能会对数据进行加密。影响: 自动化管线中断。对策: 社区通常会在 24-48 小时内破解新的加密逻辑。开发者应关注 Dimbreath 仓库的 Issue 区。若 GitHub 源失效，可切换至 Ambr.top API，因为它作为中间层屏蔽了底层解包的复杂性。7.2 文本描述不规范游戏文案有时会由不同人员撰写，导致描述格式不统一（例如有的用“造成x%伤害”，有的用“伤害值：x%”）。对策: 建立一个 正则表达式库 (Regex Registry)，随着版本更新不断补充新的匹配模式。Liangshi-Calc 的高兼容性往往也是源于其代码中积累了大量的兼容性判定逻辑。7.3 计算精度误差游戏内显示数值（如 200%）通常是 paramList 中浮点数（1.9998%）的四舍五入。对策: 自动化脚本应直接读取 paramList 的原始浮点数参与计算，但在展示层（前端渲染）使用 toFixed(1) 模拟游戏内显示，以确保计算结果与游戏实际伤害一致。8. 结论通过对 Yunzai Miao-Plugin 数据结构与原始游戏数据的深度比对，本研究得出以下结论：元数据自动化完全可行：构建一个从 Dimbreath/GenshinData 到 data.json 的转换器在技术上是成熟的，且能达到极高的准确率。这应作为自动化项目的首要切入点。伤害计算具备混合可行性：基础倍率计算可实现自动化，但涉及机制判定的逻辑需要“人机协作”。理想的模式是机器生成 80% 的样板代码，人类专家填充 20% 的核心逻辑。Liangshi-Calc 模式的优越性：其架构证明了“云端生成、客户端拉取”是解决数据时效性的最佳实践。最终建议：开发者应优先利用 Dimbreath/GenshinData 作为核心数据源，配合 Node.js 编写解析脚本，并建立 GitHub Actions 定时任务以监听数据源变动，从而实现一套类似 Liangshi-Calc 的高效、自动化的数据维护系统。参考文献与数据源引用 Miao-Plugin GitHub Repository, yoimiya-kokomi. Liangshi-Calc GitHub Repository, liangshi233. Dimbreath/AnimeGameData Obfuscation Status. Ambr.top API Documentation. Miao-Plugin package.json Dependencies. Miao-Plugin calc.js Code Analysis.